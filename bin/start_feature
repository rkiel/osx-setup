#!/usr/bin/env ruby

raise "USAGE: start_feature feature_name" unless ARGV.size == 1

FEATURE_BRANCH = ARGV[0]
BASE_BRANCH    = `git branch|grep '\*'|sed 's/\*\s*//'`.strip

raise "invalid base branch: #{BASE_BRANCH}"       unless ['master','develop'].include? BASE_BRANCH
raise "invalid feature branch: #{FEATURE_BRANCH}" if     ['master','develop'].include? FEATURE_BRANCH

def run_cmd ( cmd )
  puts cmd
  success = system cmd
  unless success
    system "git checkout #{BASE_BRANCH}"
    raise "error"
  end
end

run_cmd "git pull origin #{BASE_BRANCH}"

run_cmd "git checkout -b #{BASE_BRANCH}-#{FEATURE_BRANCH}"

run_cmd "git push origin #{BASE_BRANCH}-#{FEATURE_BRANCH}"
